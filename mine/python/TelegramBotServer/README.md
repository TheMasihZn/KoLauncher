Telegram Random HTML Bot

What it does
- A minimal Telegram bot that replies to any user message with text generated by Google's Gemini model.
- The bot also scans a random HTML file from D:\SDK\estHTML and extracts text from one of several fixed XPaths (first non-empty match):
  - /html/body/div[1]/div[2]/span
  - /html/body/div[2]/div[2]/span
  - /html/body/div[4]/div[2]/span
  - /html/body/div[7]/p
  The extracted value is included in the prompt sent to Gemini.
 - You can customize the template of the message sent to the AI using environment variables.
 - You can also override the XPaths via environment variables (see configuration below).

Requirements
- Windows
- Python 3.8+ installed and available on PATH (python command)
- A Telegram Bot Token (create via @BotFather)
- Google Gemini API access and API key

How to configure
1) Set your bot token as an environment variable TELEGRAM_BOT_TOKEN.
   - Temporary for the current terminal window:
     setx TELEGRAM_BOT_TOKEN "123456:ABC-Your-Bot-Token"  
     (Close and reopen the terminal so the variable is available.)
   - Alternatively, set it only for the current session:
     set TELEGRAM_BOT_TOKEN=123456:ABC-Your-Bot-Token

2) Ensure your HTML files exist under D:\SDK\estHTML. The bot searches .html and .htm files recursively.
   - To override the directory, set EST_HTML_DIR to a different path (optional):
     set EST_HTML_DIR=D:\path\to\your\htmls

3) Set the Gemini API key in GEMINI_API_KEY.
   - setx GEMINI_API_KEY "your_api_key_here"
   - Optional: choose model with GEMINI_MODEL (default is gemini-2.5-flash per Google's template):
     set GEMINI_MODEL=gemini-2.5-flash

4) (Optional) Customize the AI prompt template using PROMPT_TEMPLATE or EST_PROMPT_TEMPLATE.
   - The bot will fill the template using Python's str.format with the following placeholders:
     {user_text}, {xpath_value}, {chat_username}, {chat_first_name}, {chat_last_name}, {chat_title}
   - Unknown/missing placeholders are treated as empty strings.
   - Example (PowerShell / cmd):
     setx PROMPT_TEMPLATE "You are a helpful bot. User said: {user_text}. From HTML: {xpath_value}."
   - If not set, the default template is:
     "User message: {user_text}\nExtracted HTML value: {xpath_value}"

5) (Optional) Configure which XPaths to extract.
   - By default, the bot tries the four XPaths listed above and uses the first non-empty match.
   - You can override them using these environment variables (checked in this order):
     EST_XPATH_MAIN, xGeneral, xMarriga, xOriginal, xTrade
     (Legacy env vars EST_XPATH_FIRST/SECOND/THIRD are still supported for backward compatibility.)
   - Supported format is a simple subset like: /html/body/div[2]/div[2]/span
     • Only tag names with optional 1-based indices in square brackets are supported.
     • If an index is omitted, it defaults to 1.
   - Examples:
     setx EST_XPATH_MAIN "/html/body/div[3]/div[1]/span"
     setx xGeneral "/html/body/div[7]/p"
     setx xMarriga "/html/body/div[2]/div[2]/span"
     setx xOriginal "/html/body/div[1]/div[2]/span"
     setx xTrade "/html/body/div[4]/div[2]/span"
   - Invalid entries are ignored. If none are set or valid, the defaults are used.

How to run
- From the repository directory:
  python bot.py

Behavior
- The bot uses long polling to fetch updates.
- On any received message, it generates a text response via Google Gemini using the official SDK (google-genai).
- A random HTML file's text from the supported XPaths listed above is included in the prompt for additional context.

Notes
- Install dependency: pip install google-genai
- If there are no .html/.htm files, or the directory does not exist, the bot exits with an error message.
- Network/API errors are logged to the console and retried after a short delay.
